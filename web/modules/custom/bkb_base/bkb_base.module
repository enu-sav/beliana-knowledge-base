<?php

use Drupal\Core\StreamWrapper\StreamWrapperManager;

/**
 * Implements hook_page_attachments().
 */
function bkb_base_page_attachments(array &$attachments) {
  $attachments['#attached']['library'][] = 'bkb_base/admin-overrides';
}

/**
 * Implements hook_preprocess_HOOK() for navigation blocks.
 */
function bkb_base_preprocess_block(&$variables) {
  if (isset($variables['elements']['#plugin_id']) && $variables['elements']['#plugin_id'] == 'navigation_menu:content') {
    // Remove "Bloky" and "Súbory" from content navigation menu and add icons.
    if (isset($variables['content']['#items'])) {
      foreach ($variables['content']['#items'] as $key => $item) {
        if (isset($item['url'])) {
          $url = $item['url']->toString();
          // Remove Bloky and Súbory
          if ($url == '/admin/content/block' || $url == '/admin/content/files') {
            unset($variables['content']['#items'][$key]);
          }
          // Add icon class for Zdroje - using custom 'book' icon
          elseif ($url == '/admin/content/sources') {
            $variables['content']['#items'][$key]['class'] = 'book';
          }
          // Add icon class for Komentáre - using custom 'comment' icon
          elseif ($url == '/admin/content/comments') {
            $variables['content']['#items'][$key]['class'] = 'comment';
          }
        }
      }
    }
  }
}

/**
 * Implements hook_file_download().
 */
function bkb_base_file_download($uri) {
  $scheme = StreamWrapperManager::getScheme($uri);
  if ($scheme == 'private' && \Drupal::currentUser()->isAuthenticated()) {
    return [
      'Content-disposition' => 'inline;',
    ];
  }

  return NULL;
}
